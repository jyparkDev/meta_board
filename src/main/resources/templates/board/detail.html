<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <!-- CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <!-- <link href="../../static/css/board.css" type="text/css" rel="stylesheet"> -->
        <link href="/css/board.css" type="text/css" rel="stylesheet">
        <!-- JavaScript Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
                crossorigin="anonymous"></script>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100&display=swap" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
        <meta charset="UTF-8">
        <script>
            $(document).ready(function(){
                $('#open-btn').click(function(e){
                    e.stopPropagation();
                    $('#etc').css("display","block");
                });
                $('body').click(function (){
                    $('#etc').css("display","none");
                });
            });
            let passwordValid = false;
            function back(){

                window.location.href = "/";
            }
            function del(){
                if(!passwordValid){
                    deletePasswordCheck();
                    return;
                }
                delMessage();
            }
            function update(){
                if (!passwordValid){
                    updatePasswordCheck();
                    return;
                }
                if(!valid()){
                    return;
                }
                let form = document.getElementById('write-form');
                let id = $("#id").val();
                form.method ="POST";
                form.action = "/board/update?id="+id;
                form.submit();
                alert("수정 완료");
            }

            function valid(){
                let title = document.getElementById('title').value;
                let writer = document.getElementById('writer').value;
                if(title.length > 50){
                    alert('제목을 50자 이내로 작성해주세요.');
                    $('#title').focus();
                    return false;
                }
                if(writer.length > 15){
                    alert('작성자는 15자 미만입니다.')
                    $('#writer').focus();
                    return false;
                }

                return true;
            }
            function updatePasswordCheck(){
                let password = prompt("비밀번호를 입력해주세요?");
                let id = $("#id").val();
                $.ajax({
                    type: "POST",
                    url: "/board/passwd-check",
                    data: JSON.stringify({password: password,id: id}),
                    contentType: 'application/json',
                    dataType : "json",
                    success: function (response) {
                        alert("패스워드 일치");
                        $('#title').attr('readonly', false);
                        $('#writer').attr('readonly', false);
                        $('#content').attr('readonly', false);
                        $('#title').focus();
                        passwordValid = true;
                    },
                    error: function (){
                        alert("패스워드 불일치");
                    }
                });
            }

            function deletePasswordCheck(){
                let password = prompt("비밀번호를 입력해주세요?");
                let id = $("#id").val();
                $.ajax({
                    type: "POST",
                    url: "/board/passwd-check",
                    data: JSON.stringify({password: password,id: id}),
                    contentType: 'application/json',
                    dataType : "json",
                    success: function (response) {
                        delMessage();
                    },
                    error: function (){
                        alert("패스워드 불일치");
                    }
                });
            }
            function delMessage(){
                let check = confirm("정말 삭제하시겠습니까?");
                if (check){
                    let id = $("#id").val();
                    window.location.href="/board/remove?id="+id+"&check="+check;
                    alert("삭제 완료");
                }
            }
            function open_etc(){
                $('#etc').css("display","block");
            }
            function close_all(){
                $('#etc').css("display","none");
            }
        </script>
    </head>
    <body>
    <header>
        <h2>커뮤니티</h2>
    </header>
        <section class="contains">
            <h3 th:text="${board.title}">제목</h3>
            <article class="description-area">
                <div class="create-date-area">
                    <span>등록일 : </span><span th:text="${board.create_date}">0000-00-00</span>
                </div>
                <div class="writer-area">
                    <span>작성자 : </span><span th:text="${board.writer}">홍길동</span>
                </div>
            </article>
            <article class="content-area">
                <div class="content" th:text="${board.content}">
                    내용이 없습니다.
                </div>
            </article>
            <article class="btn-area">
                <div class="back-btn-area">
                    <button class="back-btn" type="button"><a th:href="@{/(page=${page}, pageSize=${pageSize})}">돌아가기</a></button>
                </div>
                <div class="etc-btn">
                    <button class="btn btn-outline-dark" type="button" id="open-btn">...</button>
                    <div class="etc" id="etc">
                        <button class="btn btn btn-light" type="button" onclick="update();">수정하기</button>
                        <button class="btn btn btn-light" type="button" onclick="del();">삭제하기</button>
                    </div>
                </div>
            </article>
        </section>

    </body>
</html>